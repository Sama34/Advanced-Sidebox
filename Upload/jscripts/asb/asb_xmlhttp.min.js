/*
 * Plugin Name: Advanced Sidebox for MyBB 1.8.x
 * Copyright 2014 WildcardSearch
 * http://www.rantcentralforums.com
 *
 * this file contains a custom class for the AJAX refresh functionality for
 * side box modules and a function to create objects for all the add-on modules
 * represented on the forum
 */

var ASB=(function(f,c){
"use strict";
function e(a,k,j){this.options=f.extend({},j||{});this.rate=this.options.rate=(this.options.rate||30);this.decay=this.options.decay=this.options.decay>=1?this.options.decay:1;this.container=f("#"+a);this.options.url=k;this.options.complete=f.proxy(this.updateComplete,this);this.phpTimeDiff=Math.floor(this.options.data.dateline-(new Date().getTime()/1000));this.start()}function i(){this.timer=setTimeout(f.proxy(this.onTimerEvent,this),(this.decay*this.rate)*1000)}function d(){clearTimeout(this.timer)}function h(a){if(typeof a.responseText!=="undefined"&&a.responseText.length>0){this.rate=this.options.rate;this.container.html(a.responseText)}else{this.rate=this.decay*this.rate}this.options.data.dateline=Math.floor(new Date().getTime()/1000+this.phpTimeDiff);this.timer=setTimeout(f.proxy(this.onTimerEvent,this),this.rate*1000)}function g(){if(this.container.width()<=0&&this.container.height()<=0){this.timer=setTimeout(f.proxy(this.onTimerEvent,this),(this.decay*this.rate)*1000);return}f.ajax(this.options)}e.prototype={start:i,stop:d,updateComplete:h,onTimerEvent:g};function b(m,l,a){var j,n="",k=0;if(m.length==0){return}for(j=0;j<m.length;j++){n=m[j].addon+"_"+m[j].id+"_e";if(!f("#"+n)){continue}k=l.left;if(m[j].position){k=l.right}new e(n,"xmlhttp.php",{type:"get",data:{action:"asb",id:m[j].id,addon:m[j].addon,dateline:m[j].dateline,width:k,script:a},rate:m[j].rate,decay:m[j].decay})}}c.ajax={buildUpdaters:b};return c})(jQuery,ASB||{});